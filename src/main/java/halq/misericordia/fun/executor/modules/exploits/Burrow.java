package halq.misericordia.fun.executor.modules.exploits;

import halq.misericordia.fun.core.modulecore.Category;
import halq.misericordia.fun.core.modulecore.Module;
import halq.misericordia.fun.executor.settings.SettingBoolean;
import net.minecraft.network.play.client.CPacketPlayer;
import net.minecraft.network.play.client.CPacketPlayerTryUseItemOnBlock;
import net.minecraft.util.EnumFacing;
import net.minecraft.util.EnumHand;
import net.minecraft.util.math.BlockPos;
import net.minecraft.util.math.Vec3d;
import net.minecraftforge.client.event.PlayerSPPushOutOfBlocksEvent;
import net.minecraftforge.fml.common.eventhandler.SubscribeEvent;

/**
 * @author Halq
 * @since 30/07/2023 at 22:27
 */

public class Burrow extends Module {

    SettingBoolean rotate = create("Rotate", false);
    SettingBoolean strict = create("Strict", false);

    public Burrow(){
        super("Burrow", Category.EXPLOITS);
    }

    @Override
    public void onUpdate(){
        BlockPos playerPos = new BlockPos(mc.player.posX, mc.player.posY, mc.player.posZ);
        EnumFacing facing = EnumFacing.UP;
        EnumHand hand = EnumHand.MAIN_HAND;

        Vec3d vec = new Vec3d(playerPos).add(0.5, 0.5, 0.5).add(new Vec3d(facing.getDirectionVec()).scale(0.5));

        float facingX = (float) (vec.x - playerPos.x);
        float facingY = (float) (vec.y - playerPos.y);
        float facingZ = (float) (vec.z - playerPos.z);

        mc.player.connection.sendPacket(new CPacketPlayer.Position(mc.player.posX, mc.player.posY + 0.42, mc.player.posZ, true));
        mc.player.connection.sendPacket(new CPacketPlayer.Position(mc.player.posX, mc.player.posY + 0.75, mc.player.posZ, true));
        mc.player.connection.sendPacket(new CPacketPlayer.Position(mc.player.posX, mc.player.posY + 1.01, mc.player.posZ, true));
        mc.player.connection.sendPacket(new CPacketPlayer.Position(mc.player.posX, mc.player.posY + 1.16, mc.player.posZ, true));

        mc.player.setPosition(mc.player.posX, mc.player.posY + 1.16610926093821D, mc.player.posZ);
        mc.player.connection.sendPacket(new CPacketPlayerTryUseItemOnBlock(playerPos, facing, hand, facingX, facingY, facingZ));
        mc.player.setPosition(mc.player.posX, mc.player.posY - 1.16610926093821D, mc.player.posZ);

        setDisabled();
    }

    @SubscribeEvent
    public void onBlockPush(PlayerSPPushOutOfBlocksEvent event){
        event.setCanceled(true);
    }
}
